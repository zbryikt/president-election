var x$;x$=angular.module("main",[]),x$.controller("main",["$scope","$http","$timeout","$interval"].concat(function(t,e,n,r){var c;return c=1,t.data={kmt:[],dpp:[],pfp:[]},t.fetch={detail:{schedule:function(e,r){return r||!t.fetch[e].handler?t.fetch[e].handler=n(function(){return t.fetch[e].detail()},0):void 0},done:function(e){return t.fetch[e].handler=null}},kmt:{handler:null,detail:function(){var n;return(n=t.data.kmt.filter(function(t){return!t[2]})[0])?(console.log("getting "+n[1]+" ..."),e({url:"http://crossorigin.me/"+n[1],method:"GET"}).success(function(e){var r;return r=$(e).find(".post_item .post-body").text(),n.push(r),t.fetch.detail.schedule("kmt",!0)}).error(function(){return t.fetch.detail.schedule("kmt",!0)})):t.fetch.detail.done("kmt")},list:function(){return e({url:"http://crossorigin.me/http://www.theway.best/search/label/%E6%9C%80%E6%96%B0%E8%A1%8C%E7%A8%8B?max-results=600",method:"GET"}).success(function(e){var n,r,c,p,o,i,l,d=[];for(n=$(e).find(".post_item"),r=0,c=n.length;c>r;++r)p=n[r],o=$(p).find("script").text(),i=/x="(.+?)",/.exec(o)[1],i=i.replace(/&#.+?;/g,""),l=/y="(.+?)",/.exec(o)[1],d.push(t.data.kmt.push([i,l]));return d})}},dpp:{handler:null,detail:function(){var n;return console.log("fetching"),(n=t.data.dpp.filter(function(t){return!t[2]})[0])?(console.log("getting "+n[1]+" ..."),e({url:"http://crossorigin.me/"+n[1],method:"GET"}).success(function(e){var r,c;return/adobeupdate.publicvm.com/.exec(e)&&(e=e.replace(/adobeupdate.publicvm.com/g,"http://www.google.com.tw/")),r=$(e).find("#contentin").text(),/行程|拜訪|參訪/.exec(r)?n.push(r):(c=t.data.dpp.indexOf(n),t.data.dpp.splice(c,1)),t.fetch.detail.schedule("dpp",!0)}).error(function(){return t.fetch.detail.schedule("dpp",!0)})):t.fetch.detail.done("dpp")},list:function(n){return console.log("fetch dpp list page "+n),e({url:"http://crossorigin.me/http://www.dpp.org.tw/news.php?page="+n,method:"GET"}).success(function(e){var r,c,p,o,i,l,d,u;for(r=$(e).find(".listin_content"),c=[],p=0,o=r.length;o>p;++p)i=r[p],l=$(i).find(".listin_title").text(),d=$(i).find(".listin_more a").attr("href"),d=/show_news\('([^']+)'\)/.exec(d),d&&(d="http://www.dpp.org.tw/news_content.php?sn="+d[1],c.push([l,d]));return console.log(c),(u=t.data).dpp=u.dpp.concat(c),40>n?t.fetch.dpp.list(n+1):t.fetch.detail.schedule("dpp")})}},pfp:{handler:null,detail:function(){var n;return n=t.data.pfp.filter(function(t){return!t[2]})[0],n?e({url:"http://crossorigin.me/"+n[1],method:"GET"}).success(function(e){var r;return r=$(e).find(".L_lmContent2").text(),n.push(r),t.fetch.detail.schedule("pfp",!0)}).error(function(){return t.fetch.detail.schedule("pfp",!0)}):t.fetch.detail.done("pfp")},list:function(n){return console.log("fetch pfp list page "+n),e({url:"http://crossorigin.me/http://www.pfp.org.tw/Article.asp?id=13&page="+n,method:"GET"}).success(function(e){var r,c,p,o,i,l,d,u,a,s;for(r=$(e).find("table[width=683] tr td a"),c=[],p=null,o=0,i=r.length;i>o;++o)l=r[o],d=/page=(\d+)/.exec(s),d&&parseInt(d[1])>n&&(p=parseInt(d[1])),u=[$(l).text(),$(l).attr("href")],a=u[0],s=u[1],/^article_show/.exec(s)&&/公開行程/.exec(a)&&c.push([$(l).text(),"http://www.pfp.org.tw/"+$(l).attr("href")]);return(u=t.data).pfp=u.pfp.concat(c),p&&10>p?t.fetch.pfp.list(p):t.fetch.detail.schedule("pfp")})}}},t.fetch.dpp.list(1),r(function(){return t.fetch.detail.schedule("dpp")},1e3)}));